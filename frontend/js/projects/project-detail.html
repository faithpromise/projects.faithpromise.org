<div class="Project">

  <div class="Project-header">
    <div class="Project-titleColumn">
      <span class="Project-title"><a href="/people/{{ vm.project.requester.id }}">{{ vm.project.requester.name }}</a> / <span ng-if="vm.project.event"><a href="/events/{{ vm.project.event.id }}">{{ vm.project.event.name }}</a> / </span>{{ vm.project.name }}</span>
    </div>
    <div class="Project-statusColumn">
      <span class="Project-status">Waiting on Feedback</span>
    </div>
    <div class="Project-datesColumn">
      <span class="Project-due">Due on {{ vm.project.due_at | amDateFormat: 'MMMM D' }}</span>
      <span class="Project-estimatedCompletion" ng-class="{ 'warning': vm.project.is_overdue_likely }">
        <i class="Project-dueWarningIcon icon-exclamation" ng-if="vm.project.is_overdue_likely"></i>
        Estimated delivery: {{ vm.project.estimated_delivery_date | amDateFormat: 'MMMM D' }}</span>
    </div>
  </div>

  <div class="Project-body">
    <div class="Project-detailsColumn">
      <div class="Project-eventNotes" ng-if="vm.project.event">
        <div><span class="Label">Event Notes <span class="link">(edit)</span></span></div>
        {{ vm.project.event.notes }}
      </div>
      <div class="Project-entry">
        <div><span class="Label">Project Notes <img class="Label-loading" src="/build/images/loading-white-bg.gif" ng-show="vm.project_notes_saving"></span></div>
        <textarea class="Project-textarea" ng-model="vm.project.notes" msd-elastic></textarea>
      </div>

      <div class="Project-entry">
        <div class="Label">Default Recipients</div>
        <user-picker selected="vm.project.recipients" on-change="vm.save_recipients()"></user-picker>
        <ul>
          <li ng-repeat="recipient in vm.project.recipients">{{ recipient.name }} <i class="icon-cancel" ng-click="vm.remove_recipient(recipient)"></i></li>
        </ul>
      </div>
    </div>

    <!--Comments-->
    <div class="Project-commentsColumn">
      <new-comment ng-if="vm.project.id" project="vm.project"></new-comment>
      <comments ng-if="vm.project.id" project="vm.project"></comments>
    </div>

    <!-- Task Detail -->
    <div class="Project-tasksColumn" ng-if="vm.route_action === 'task'">
      <task-detail task="vm.selected_task" on-close="vm.on_task_closed()" on-update="vm.on_task_updated()"></task-detail>
    </div>

    <!-- Tasks -->
    <div class="Project-tasksColumn" ng-hide="vm.route_action === 'task'">

      <!-- New task form -->
      <new-task ng-if="vm.project.id" project="vm.project" on-submit="vm.on_task_submitted()" on-success="vm.on_task_added()"></new-task>

      <img class="Project-tasksLoading" src="/build/images/loading-white-bg.gif" ng-hide="vm.tasks">

      <div class="Project-task" ng-repeat="task in vm.tasks" ng-hide="task.completed_at">

        <div class="Task">
          <div class="Task-check">
            <input type="checkbox" ng-model="task.foobar_required_for_ng_change" ng-change="vm.mark_task_completed(task)">
          </div>
          <span class="Task-info" ng-click="vm.open_task(task)" href="/projects/{{ vm.project.id }}/tasks/{{ task.id }}">
            <div class="Task-name">{{ task.name }} <img class="Loading--mini" src="/build/images/loading-white-bg.gif" ng-show="task.saving"></div>
            <div class="Task-meta">
              {{ task.agent.abbreviation }} &middot; {{ task.duration | amDurationFormat : 'minute' }} &middot; Start {{ task.estimated_start_date | amDateFormat: 'MMMM D' }}<span ng-show="task.notes"> &middot; <i class="Task-icon icon-doc"></i></span>
            </div>
          </span>
        </div>

      </div>
      <p class="CompletedTask" ng-repeat="task in vm.tasks" ng-show="task.completed_at" ng-click="vm.open_task(task)">{{ task.name }} on {{ task.completed_at | amDateFormat: 'MMMM D, YYYY' }}</p>
    </div>
  </div>
</div>
